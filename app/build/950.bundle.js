(()=>{var t,e,r,n,o={13732:()=>{},18489:()=>{},42634:()=>{},59169:()=>{},66020:()=>{},86833:()=>{},94081:(t,e,r)=>{"use strict";var n={};r.r(n),r.d(n,{estimateShowCoordinateSystem:()=>J,findGreedyAssignment:()=>v,loadShow:()=>Q});var o=r(59688),i=r.n(o),a=r(52490),s=r(21220),c=r.n(s),u=r(30679),l=r(29008);r(93291),r(67912);function f(t){return t*Math.PI/180}function h(t){return 180*t/Math.PI}function p(t,e=2){const r=Array.from({length:e},()=>0),n=t&&Array.isArray(t)?t.length:0;if(0===n)return r;for(const n of t)for(let t=0;t<e;t++)r[t]=(r[t]??0)+(n[t]??0);for(let t=0;t<e;t++)r[t]=(r[t]??0)/n;return r}function d(t,e,{distanceFunction:r,getter:n=l.default}){const o=t.map(n),i=e.map(n);return o.map(t=>i.map(e=>r(t,e)))}const g=(t,e)=>Math.hypot(t[0]-e[0],t[1]-e[1]);function m(t,e){const{algorithm:r,...n}=e??{algorithm:"greedy"};switch(r){case"hungarian":return c()(t);case"greedy":return function(t,e={}){const r=t.length,n=r>0?Math.min(...t.map(t=>t.length)):0,o=[],i=[];let{threshold:a}=e;if(0===r||0===n)return[];("number"!=typeof a||a<=0||Number.isNaN(a))&&(a=Number.POSITIVE_INFINITY);for(const[e,r]of t.entries())for(const[t,n]of r.entries())n<=a&&o.push([e,t,n]);const s=(0,u.A)(o,t=>t[2]),c=Array.from({length:r}).fill(!1),l=Array.from({length:n}).fill(!1);let f=r,h=n;for(const[t,e,r]of s)if(!(c[t]||l[e]||(i.push([t,e]),c[t]=!0,l[e]=!0,f--,h--,f&&h)))break;return i}(t,n);default:throw new Error("unknown assignment algorithm: "+r)}}function y(t,e,r){const{matching:n,...o}=r,i=r?.matching;return m(d(t,e,o),i)}async function v(t,e,r){switch(r.distanceMetric){case"euclidean":return async function(t,e,r){return y(t,e,{distanceFunction:g,matching:{algorithm:"greedy",...r}})}(t,e,r);case"geodetic":return async function(t,e,r){return y(t,e,{distanceFunction:a.Yf,matching:{algorithm:"greedy",...r}})}(t,e,r);default:throw new Error(`Unknown distance metric: ${r.distanceMetric}`)}}var _,O=r(46996),b=r(39181),w=r(26144);!function(t){t.NEU="neu",t.NWU="nwu"}(_||(_={}));r(1274);var S,L,A=r(83171),M=r(97859),N=r(6933),E=r(82986),I=r(12060),T=r(54602),P=r(75811),x=r(72057),k=r(20224),j=r(40476),C=r(39006),F=r(58852);!function(t){t.CIRCLE="circle",t.LINE_STRING="lineString",t.POINTS="points",t.POLYGON="polygon"}(S||(S={})),function(t){t.HIDDEN="hidden",t.NORMAL="normal",t.THICK_OUTLINE="thickOutline",t.THIN_OUTLINE="thinOutline"}(L||(L={}));S.CIRCLE,k.A,j.A,S.LINE_STRING,x.A,S.POINTS,P.A,S.POLYGON,C.A,F.A;var U;!function(t){t.ABSOLUTE="absolute",t.WAYPOINT="waypoint"}(U||(U={}));var R;!function(t){t.GROUND="ground",t.HOME="home",t.MSL="msl"}(R||(R={}));const $=[{multiplier:1e3,unit:"km"},{multiplier:1,unit:"m"},{multiplier:.01,unit:"cm"}],G=(t,e)=>t+(/^[a-zA-Z]/.test(e)?"\xa0":"")+e,W=(t,e="",r=0)=>{if(Array.isArray(e)&&e.length>0){const{multiplier:n,unit:o,digits:i=r}=e.find(({multiplier:e,breakpoint:r=1})=>r<=Math.abs(t)/e)??e.at(-1);return G(0===t?"0":(t/n).toFixed(i),o)}return G(0===t?"0":t.toFixed(r),"string"==typeof e?e:"")};navigator.platform.includes("Mac"),navigator.platform.includes("Win32")||navigator.platform.includes("Windows"),navigator.maxTouchPoints,Symbol("Longitude"),Symbol("Latitude"),Symbol("Easting"),Symbol("Northing");(0,A.A)((t,e)=>D(t,[e])[0]);const Y=t=>t instanceof E.default&&t.getSource()instanceof T.default,D=(0,A.A)((t,e)=>{const r=Array.from({length:e.length});for(const n of t.getLayers().getArray()){if(!Y(n)||!n.getVisible())continue;const t=n.getSource();if(t)for(const[n,o]of e.entries())if(!r[n]){const e=t.getFeatureById(o);e&&(r[n]=e)}}return r});(0,A.A)((t,e)=>{const r=t[0],n=t[1];return 0===r&&0===n?e:e.map(t=>[t[0]+r,t[1]+n])});const B=t=>(e,r)=>{if((0,M.default)(e))return r;try{return t(e)}catch{return r}},H=(B(t=>{const{reference:e,value:r}=t,n=((t,e=2)=>W(t,$,e))(r);switch(e){case R.MSL:return n+" AMSL";case R.HOME:return n+" above home";case R.GROUND:return n+" above ground";default:return`${n} above unknown reference: ${String(e)}`}}),B(t=>{const{mode:e,value:r}=t,n=r.toFixed(1)+"\xb0";return e===U.WAYPOINT?"Always face next waypoint":e===U.ABSOLUTE?n:`${n} @ unknown mode: ${String(e)}`}),(({digits:t,reverse:e=!1,separator:r=", ",unit:n})=>{const o=e?[1,0]:[0,1]})({digits:7,reverse:!0,unit:"\xb0"}),((t,e)=>{const r=1/e,n=r*(2-r),o=Math.sqrt(n),i=t*(1-r),a=(i+2*t)/3;return Object.freeze({eccentricity:o,eccentricitySquared:n,flattening:r,inverseFlattening:e,meanRadius:a,semiMajorAxis:t,semiMinorAxis:i})})(6378137,298.257223563));I.Rb,I.WP;class V{_vec=[0,0,0];_origin;_orientation;_ellipsoid;_type;_piOver180;_r1;_r2OverCosOriginLatInRadians;_yMul;constructor({origin:t,orientation:e=0,type:r="neu",ellipsoid:n=H}){if("neu"!==r&&"nwu"!==r)throw new Error("unknown coordinate system type: "+r);if("number"!=typeof e&&(e=Number.parseFloat(e)),Number.isNaN(e))throw new TypeError("invalid orientation");this._vec=[0,0,0],this._origin=t,this._orientation=f(e),this._ellipsoid=n,this._type=r,this._precalculate()}fromLonLat(t){const e=[0,0];return this._updateArrayFromLonLat(e,t[0],t[1]),e}fromLonLatAhl(t){const e=[0,0,t[2]];return this._updateArrayFromLonLat(e,t[0],t[1]),e}get type(){return this._type}toLonLat(t){const e=[t[0],t[1]*this._yMul];return N.e$(e,this._orientation),[e[1]/this._r2OverCosOriginLatInRadians/this._piOver180+this._origin[0],e[0]/this._r1/this._piOver180+this._origin[1]]}toLonLatAhl(t){return[...this.toLonLat([t[0],t[1]]),t[2]]}updateVector3FromLonLatAhl(t,e,r,n){this._updateArrayFromLonLat(this._vec,e,r),t.x=this._vec[0],t.y="nwu"===this._type?this._vec[1]:-this._vec[1],t.z=n}_precalculate(){const t=f(this._origin[1]),e=this._ellipsoid.semiMajorAxis,r=this._ellipsoid.eccentricitySquared,n=1-r*Math.sin(t)**2;this._piOver180=Math.PI/180,this._r1=e*(1-r)/n**1.5,this._r2OverCosOriginLatInRadians=e/Math.sqrt(n)*Math.cos(t),this._yMul="neu"===this._type?1:-1}_updateArrayFromLonLat(t,e,r){t[0]=(r-this._origin[1])*this._piOver180*this._r1,t[1]=(e-this._origin[0])*this._piOver180*this._r2OverCosOriginLatInRadians,N.e$(t,-this._orientation),t[1]*=this._yMul}}if(w.COORDINATE_SYSTEM_TYPE!==_.NWU)throw new Error(`The coordinate system type ${w.COORDINATE_SYSTEM_TYPE} is not supported by the auto-fit algorithm`);function q(t,e){return[t[0]-e[0],t[1]-e[1]]}function z(t,e){const r=f(e),n=Math.cos(r),o=Math.sin(r);return[t[0]*n+t[1]*o,t[0]*-o+t[1]*n]}function Z(t,e){return void 0===e&&(e=p(t)),t.map(t=>q(t,e))}function K(t,e){return t.map(t=>e.fromLonLat(t))}const J=function(t){return function(t,e,r={}){const{takeoffCoordinates:n,uavGPSCoordinates:o}=e,{maxIterations:i=20}=r;let a,s,c=!1;for(let e=0;e<i&&!c;e++){const r=new V(t),u=K(o,r);if(a=y(u,n,{distanceFunction:g,matching:{algorithm:"hungarian"}}),a.sort((t,e)=>t[1]-e[1]),(0,O.default)(a,s)&&(c=!0),0===a.length)throw new Error("Failed to find a sufficiently close matching between the drones and the takeoff positions");s&&(a.length<s.length||e===i-1)?a=s:s=a;const l=a.length;let f=a.map(([t,e])=>u[t]),d=a.map(([t,e])=>n[e]);const m=p(f),v=p(d);f=Z(f,m),d=Z(d,v);const w=[[0,0],[0,0]];for(let t=0;t<l;t++){const e=f[t],r=d[t];w[0][0]+=e[0]*r[0],w[0][1]+=e[0]*r[1],w[1][0]+=e[1]*r[0],w[1][1]+=e[1]*r[1]}const S=(0,b.SVD)(w),L=[[S.u[0][0]*S.v[0][0]+S.u[0][1]*S.v[0][1],S.u[0][0]*S.v[1][0]+S.u[0][1]*S.v[1][1]],[S.u[1][0]*S.v[0][0]+S.u[1][1]*S.v[0][1],S.u[1][0]*S.v[1][0]+S.u[1][1]*S.v[1][1]]],A=h(Math.atan2(L[0][1],L[0][0])),M=q(m,z(v,A));t={origin:r.toLonLat([M[0],M[1]]),orientation:t.orientation+A,type:_.NWU}}return t}(function(t){const{uavGPSCoordinates:e,uavHeadings:r,takeoffCoordinates:n}=t,o=r.filter(t=>"number"==typeof t);if(0===e.length)throw new Error("There are no UAVs with known GPS coordinates to work with");const i=p(e),a=function(t){const e=[0,0];for(const r of t.map(f))e[0]+=Math.cos(r),e[1]+=Math.sin(r);const r=h(Math.atan2(e[1],e[0]));return r<0?r+360:r}(o),s=new V({origin:i,orientation:0,type:_.NWU}),c=p(K(e,s)),u=p(n),l=q(c,z(u,a));return{origin:s.toLonLat(l),orientation:a,type:_.NWU}}(t),t)};async function Q(t,e={}){const{returnBlob:r=!0}=e,{showSpec:n,zip:i}=await(0,w.loadShowSpecificationAndZip)(t);let a;return r&&(a=t instanceof File?new Uint8Array(await t.arrayBuffer()):t instanceof Uint8Array?t:await i.generateAsync({type:"uint8array"})),new o.Transfer({spec:n,blob:a},a?[a.buffer]:[])}i().worker(n)}},i={};function a(t){var e=i[t];if(void 0!==e)return e.exports;var r=i[t]={id:t,loaded:!1,exports:{}};return o[t].call(r.exports,r,r.exports,a),r.loaded=!0,r.exports}a.m=o,a.x=()=>{var t=a.O(void 0,[435,164],()=>a(94081));return t=a.O(t)},t=[],a.O=(e,r,n,o)=>{if(!r){var i=1/0;for(l=0;l<t.length;l++){for(var[r,n,o]=t[l],s=!0,c=0;c<r.length;c++)(!1&o||i>=o)&&Object.keys(a.O).every(t=>a.O[t](r[c]))?r.splice(c--,1):(s=!1,o<i&&(i=o));if(s){t.splice(l--,1);var u=n();void 0!==u&&(e=u)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[r,n,o]},a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},r=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,a.t=function(t,n){if(1&n&&(t=this(t)),8&n)return t;if("object"==typeof t&&t){if(4&n&&t.__esModule)return t;if(16&n&&"function"==typeof t.then)return t}var o=Object.create(null);a.r(o);var i={};e=e||[null,r({}),r([]),r(r)];for(var s=2&n&&t;("object"==typeof s||"function"==typeof s)&&!~e.indexOf(s);s=r(s))Object.getOwnPropertyNames(s).forEach(e=>i[e]=()=>t[e]);return i.default=()=>t,a.d(o,i),o},a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.f={},a.e=t=>Promise.all(Object.keys(a.f).reduce((e,r)=>(a.f[r](t,e),e),[])),a.u=t=>t+".bundle.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=r[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t})(),(()=>{var t={950:1};a.f.i=(e,r)=>{t[e]||importScripts(a.p+a.u(e))};var e=self.webpackChunk_skybrush_live=self.webpackChunk_skybrush_live||[],r=e.push.bind(e);e.push=e=>{var[n,o,i]=e;for(var s in o)a.o(o,s)&&(a.m[s]=o[s]);for(i&&i(a);n.length;)t[n.pop()]=1;r(e)}})(),n=a.x,a.x=()=>Promise.all([a.e(435),a.e(164)]).then(n);a.x()})();